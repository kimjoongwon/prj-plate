enum ReservationStatus {
    PENDING
    CONFIRMED
    CANCELLED
}

model Reservation {
    id             String            @id @default(cuid())
    status         ReservationStatus @default(CONFIRMED)
    userId         String            @unique
    timelineItemId String            @unique
    timelineItem   TimelineItem      @relation(fields: [timelineItemId], references: [id])
    createdAt      DateTime          @default(now()) @db.Timestamptz(6)
    updatedAt      DateTime?         @updatedAt @db.Timestamptz(6)
    removedAt      DateTime?         @db.Timestamptz(6)

    @@unique([userId, timelineItemId])
}

enum SessionTypes {
    ONE_TIME
    RECURRING
}

enum RepeatCycleTypes {
    DAY
    WEEK
    MONTH
    YEAR
}

enum SessionEndTypes {
    NEVER
    ON_DATE
    AFTER_OCCURRENCES
}

enum RecurringDayOfTheWeek {
    MONDAY
    TUESDAY
    WEDNESDAY
    THURSDAY
    FRIDAY
    SATURDAY
    SUNDAY
}

model Session {
    id                    String                  @id @default(cuid())
    name                  String
    tenancyId             String
    type                  SessionTypes            @default(ONE_TIME)
    repeatCycle           Int                     @default(1)
    repeatCycleType       RepeatCycleTypes        @default(DAY)
    recurringDayOfTheWeek RecurringDayOfTheWeek[] @default([])
    endType               SessionEndTypes         @default(NEVER)
    endOnDate             DateTime?               @db.Date()
    endAfterOccurrences   Int?                    @default(0)
    createdAt             DateTime                @default(now()) @db.Timestamptz(6)
    updatedAt             DateTime?               @updatedAt @db.Timestamptz(6)
    removedAt             DateTime?               @db.Timestamptz(6)
    timelines             Timeline[]
}

model Timeline {
    id             String         @id @default(cuid())
    sessionId      String
    timelineItemId String?
    date           DateTime       @db.Date()
    createdAt      DateTime       @default(now()) @db.Timestamptz(6)
    updatedAt      DateTime?      @updatedAt @db.Timestamptz(6)
    removedAt      DateTime?      @db.Timestamptz(6)
    session        Session        @relation(fields: [sessionId], references: [id])
    timelineItems  TimelineItem[]
}

model TimelineItem {
    id            String        @id @default(cuid())
    title         String
    startDateTime DateTime      @db.Timestamptz(6)
    endDateTime   DateTime      @db.Timestamptz(6)
    description   String
    address       String?
    maxCapacity   Int
    minCapacity   Int
    createdAt     DateTime      @default(now()) @db.Timestamptz(6)
    updatedAt     DateTime?     @updatedAt @db.Timestamptz(6)
    removedAt     DateTime?     @db.Timestamptz(6)
    reservations  Reservation[]
    timelineId    String?
    timeline      Timeline?     @relation(fields: [timelineId], references: [id])
}
