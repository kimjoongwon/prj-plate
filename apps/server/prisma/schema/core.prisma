model Category {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  name      String        @unique
  type      CategoryTypes @default(ROOT)
  parentId  String?
  serviceId String
  tenantId  String

  service         Service          @relation(fields: [serviceId], references: [id])
  parent          Category?        @relation("CategoryToCategory", fields: [parentId], references: [id])
  children        Category[]       @relation("CategoryToCategory")
  classifications Classification[]
  tenant          Tenant           @relation(fields: [tenantId], references: [id])
}

model Classification {
  id         String  @id @default(uuid())
  seq        Int     @unique @default(autoincrement())
  categoryId String
  userId     String? @unique
  contentId  String? @unique
  spaceId    String? @unique
  roleId     String? @unique
  fileId     String? @unique
  timelineId String? @unique

  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  category Category @relation(fields: [categoryId], references: [id])

  user     User?     @relation(fields: [userId], references: [id])
  space    Space?    @relation(fields: [spaceId], references: [id])
  role     Role?     @relation(fields: [roleId], references: [id])
  timeline Timeline? @relation(fields: [timelineId], references: [id])
  file     File?     @relation(fields: [fileId], references: [id])

  @@unique([categoryId, userId])
  @@unique([categoryId, spaceId])
  @@unique([categoryId, roleId])
  @@unique([categoryId, timelineId])
  @@unique([categoryId, contentId])
  @@unique([categoryId, fileId])
}

model Group {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  name      String
  label     String
  serviceId String
  tenantId  String

  service      Service       @relation(fields: [serviceId], references: [id])
  associations Association[]
  tenant       Tenant        @relation(fields: [tenantId], references: [id])
}

model Service {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  label String
  name  ServiceNames @unique

  groups     Group[]
  categories Category[]
}

model Association {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  groupId    String
  userId     String?
  spaceId    String?
  timelineId String?
  roleId     String?
  fileId     String?
  contentId  String?

  group    Group     @relation(fields: [groupId], references: [id])
  user     User?     @relation(fields: [userId], references: [id])
  space    Space?    @relation(fields: [spaceId], references: [id])
  role     Role?     @relation(fields: [roleId], references: [id])
  timeline Timeline? @relation(fields: [timelineId], references: [id])
  content  Content?  @relation(fields: [contentId], references: [id])
  file     File?     @relation(fields: [fileId], references: [id])
}

model Profile {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  name     String
  nickname String  @unique
  userId   String
  depotId  String?

  user  User   @relation(fields: [userId], references: [id])
  depot Depot? @relation(fields: [depotId], references: [id])
}

model User {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  phone    String @unique
  name     String @unique
  password String

  profiles       Profile[]
  associations   Association[]
  classification Classification?
  tenants        Tenant[]
}

model Tenant {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  userId  String
  roleId  String
  spaceId String

  user       User       @relation(fields: [userId], references: [id])
  space      Space      @relation(fields: [spaceId], references: [id])
  role       Role       @relation(fields: [roleId], references: [id])
  categories Category[]
  groups     Group[]
  timelines  Timeline[]
  contents   Content[]
  files      File[]
}

model Space {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  name  String @unique
  label String

  classification Classification?
  associations   Association[]
  tenants        Tenant[]
  tenancy        Tenancy?
}

model Tenancy {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  spaceId String @unique

  space Space @relation(fields: [spaceId], references: [id])
}

// model SMS {
//   id        String    @id @default(uuid())
//   seq       Int       @unique @default(autoincrement())
//   createdAt DateTime  @default(now()) @db.Timestamptz(6)
//   updatedAt DateTime? @updatedAt @db.Timestamptz(6)
//   removedAt DateTime? @db.Timestamptz(6)

//   sentAt    DateTime @db.Timestamptz(6)
//   messageId String

//   status SMSStatus @default(PROGRESS)
// }

// model SystemEmail {
//   id         String    @id @default(uuid())
//   seq        Int       @unique @default(autoincrement())
//   createdAt  DateTime  @default(now()) @db.Timestamptz(6)
//   updatedAt  DateTime? @updatedAt @db.Timestamptz(6) //   removedAt DateTime? @db.Timestamptz(6)
//   messageId  String
//   templateId String
//   tenancyId  String
//   sentAt     DateTime  @db.Timestamptz(6)
// }

// model Message {
//   id        String    @id @default(uuid())
//   seq       Int       @unique @default(autoincrement())
//   createdAt DateTime  @default(now()) @db.Timestamptz(6)
//   updatedAt DateTime? @updatedAt @db.Timestamptz(6)
//   removedAt DateTime? @db.Timestamptz(6)

//   toUserIds  String[]
//   fromUserId String
//   contentId  String
// }
model Timeline {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  name     String
  label    String
  tenantId String

  sessions        Session[]
  tenant          Tenant          @relation(fields: [tenantId], references: [id])
  classifications Classification?
  associations    Association[]
}

model Session {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  type               SessionTypes        @default(ONE_TIME)
  repeatCycleType    RepeatCycleTypes?
  startDateTime      DateTime?           @db.Timestamptz(6)
  endDateTime        DateTime?           @db.Timestamptz(6)
  recurringDayOfWeek RecurringDayOfWeek?
  recurringMonth     Int?
  timelineId         String

  timeline Timeline @relation(fields: [timelineId], references: [id])
  program  Program?
}

model Program {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  routineId    String
  sessionId    String @unique
  instructorId String
  capacity     Int

  session Session @relation(fields: [sessionId], references: [id])
}

model Routine {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  name      String
  label     String
  contentId String

  content    Content    @relation(fields: [contentId], references: [id])
  activities Activity[]
}

model Activity {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  taskId    String
  routineId String

  routine Routine @relation(fields: [routineId], references: [id])
  task    Task    @relation(fields: [taskId], references: [id])
}

model Exercise {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  duration Int
  count    Int
  taskId   String @unique

  task Task @relation(fields: [taskId], references: [id])
}

model Task {
  id  String @id @default(uuid())
  seq Int    @unique @default(autoincrement())

  name      String
  label     String
  contentId String

  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  content    Content    @relation(fields: [contentId], references: [id])
  exercise   Exercise?
  activities Activity[]
}

model Role {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  name     Roles  @unique @default(USER)
  tenantId String

  classification Classification?
  associations   Association[]
  abilities      Ability[]
  tenants        Tenant[]
}

model Action {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  name       AbilityActions @default(CREATE)
  conditions Json?
  tenantId   String
}

model Subject {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  name     String @unique
  tenantId String
}

model Ability {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  type        AbilityTypes
  roleId      String
  description String?
  conditions  Json?
  subjectId   String
  tenantId    String

  role Role @relation(fields: [roleId], references: [id])
}

// model Template {
//   id           String        @id @default(uuid())
//   seq          Int           @unique @default(autoincrement())
//   name         TemplateNames @unique @default(WELCOME)
//   postId       String        @unique
//   createdAt    DateTime      @default(now()) @db.Timestamptz(6)
//   updatedAt    DateTime?     @updatedAt @db.Timestamptz(6)
//   removedAt    DateTime?     @db.Timestamptz(6)
//   systemEmails SystemEmail[]
//   post         Post          @relation(fields: [postId], references: [id])
// }

// model Qna {
//   id        String     @id @default(uuid())
//   seq       Int        @unique @default(autoincrement())
//   status    QnaStatus  @default(OPEN)
//   spaceId   String
//   createdAt DateTime   @default(now()) @db.Timestamptz(6)
//   updatedAt DateTime?  @updatedAt @db.Timestamptz(6)
//   removedAt DateTime?  @db.Timestamptz(6)
//   question  Question[]
// }

// model Question {
//   id        String    @id @default(uuid())
//   seq       Int       @unique @default(autoincrement())
//   postId    String    @unique
//   qnaId     String
//   spaceId   String
//   createdAt DateTime  @default(now()) @db.Timestamptz(6)
//   updatedAt DateTime? @updatedAt @db.Timestamptz(6)
//   removedAt DateTime? @db.Timestamptz(6)
//   answers   Answer[]
//   post      Post      @relation(fields: [postId], references: [id])
//   qna       Qna       @relation(fields: [qnaId], references: [id])
// }

// model Answer {
//   id         String    @id @default(uuid())
//   seq        Int       @unique @default(autoincrement())
//   questionId String
//   postId     String
//   spaceId    String
//   createdAt  DateTime  @default(now()) @db.Timestamptz(6)
//   updatedAt  DateTime? @updatedAt @db.Timestamptz(6)
//   removedAt  DateTime? @db.Timestamptz(6)
//   post       Post      @relation(fields: [postId], references: [id])
//   question   Question  @relation(fields: [questionId], references: [id])
// }

model Post {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  contentId String
  content   Content @relation(fields: [contentId], references: [id])
}

model Content {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  title        String?
  description  String?
  type         TextTypes     @default(Editor)
  text         String?       @db.VarChar(1000)
  depotId      String?
  tenantId     String
  routines     Routine[]
  tasks        Task[]
  depot        Depot?        @relation(fields: [depotId], references: [id])
  tenant       Tenant        @relation(fields: [tenantId], references: [id])
  associations Association[]
  posts        Post[]
}

model Depot {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)
  files     File[]
  contents  Content[]
  profiles  Profile[]
}

model File {
  id       String @id @default(uuid())
  seq      Int    @unique @default(autoincrement())
  name     String
  depotId  String
  size     Int
  mimeType String
  url      String

  tenantId String

  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  depot          Depot           @relation(fields: [depotId], references: [id])
  tenant         Tenant          @relation(fields: [tenantId], references: [id])
  classification Classification?
  associations   Association[]
}

enum SMSStatus {
  PROGRESS
  PENDING
  SENT
  FAILED
}

enum ReservationStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

enum SessionTypes {
  ONE_TIME
  ONE_TIME_RANGE
  RECURRING
}

enum RepeatCycleTypes {
  WEEKLY
  MONTHLY
}

enum SessionEndTypes {
  NEVER
  ON_DATE
  AFTER_OCCURRENCES
}

enum RecurringDayOfWeek {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

enum AbilityActions {
  CREATE
  READ
  UPDATE
  DELETE
  ACCESS
}

enum AbilityTypes {
  CAN
  CAN_NOT
}

enum Roles {
  USER
  SUPER_ADMIN
  ADMIN
}

enum TemplateNames {
  WELCOME
  EMAIL_VERIFICATION
  RESET_PASSWORD
}

enum QnaStatus {
  OPEN
  CLOSED
}

enum TextTypes {
  Editor
  Input
  Textarea
}

enum CategoryTypes {
  LEAF
  ROOT
}

enum ServiceNames {
  USER
  ROLE
  SPACE
  CONTENT
  TIMELINE
  FILE
}

enum DepotTypes {
  ROOT
  LEAF
}
