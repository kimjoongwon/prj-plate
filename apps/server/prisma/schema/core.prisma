model Category {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  name      String
  type      CategoryTypes @default(ROOT)
  parentId  String?
  serviceId String
  tenancyId String

  service         Service          @relation(fields: [serviceId], references: [id])
  parent          Category?        @relation("CategoryToCategory", fields: [parentId], references: [id])
  children        Category[]       @relation("CategoryToCategory")
  tenancy         Tenancy          @relation(fields: [tenancyId], references: [id])
  classifications Classification[]
}

model Classification {
  id         String    @id @default(uuid())
  seq        Int       @unique @default(autoincrement())
  categoryId String
  userId     String?   @unique
  postId     String?   @unique
  spaceId    String?   @unique
  roleId     String?   @unique
  serviceId  String
  tenancyId  String
  createdAt  DateTime  @default(now())
  updatedAt  DateTime? @updatedAt @db.Timestamptz(6)
  removedAt  DateTime? @db.Timestamptz(6)

  category Category @relation(fields: [categoryId], references: [id])
  service  Service  @relation(fields: [serviceId], references: [id])
  tenancy  Tenancy  @relation(fields: [tenancyId], references: [id])
  user     User?    @relation(fields: [userId], references: [id])
  space    Space?   @relation(fields: [spaceId], references: [id])
  role     Role?    @relation(fields: [roleId], references: [id])

  @@unique([categoryId, userId])
  @@unique([categoryId, postId])
  @@unique([categoryId, spaceId])
  @@unique([categoryId, roleId])
}

model Group {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  name      String
  serviceId String
  tenancyId String

  service      Service       @relation(fields: [serviceId], references: [id])
  associations Association[]
  tenancy      Tenancy       @relation(fields: [tenancyId], references: [id])
}

model Service {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  name  ServiceNames @unique
  label String

  groups          Group[]
  categories      Category[]
  classifications Classification[]
  associations    Association[]
}

model Association {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  groupId   String
  userId    String?
  spaceId   String?
  serviceId String
  tenancyId String

  group   Group   @relation(fields: [groupId], references: [id])
  user    User?   @relation(fields: [userId], references: [id])
  // post    Post?   @relation(fields: [postId], references: [id])
  space   Space?  @relation(fields: [spaceId], references: [id])
  service Service @relation(fields: [serviceId], references: [id])
  tenancy Tenancy @relation(fields: [tenancyId], references: [id])
}

model Profile {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  depotId  String?
  nickname String
  userId   String

  user  User   @relation(fields: [userId], references: [id])
  depot Depot? @relation(fields: [depotId], references: [id])
}

model User {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  email     String @unique
  name      String @unique
  phone     String @unique
  password  String
  tenancyId String

  // posts          Post[]
  profiles       Profile[]
  tenants        Tenant[]
  associations   Association[]
  tenancy        Tenancy         @relation(fields: [tenancyId], references: [id])
  classification Classification?
}

model Tenant {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  userId  String
  roleId  String
  spaceId String

  user  User  @relation(fields: [userId], references: [id])
  space Space @relation(fields: [spaceId], references: [id])
  role  Role  @relation(fields: [roleId], references: [id])
}

model Space {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  name String @unique

  classification Classification?
  associations   Association[]
  tenancy        Tenancy?
  tenants        Tenant[]
}

model Tenancy {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  spaceId String @unique

  space           Space            @relation(fields: [spaceId], references: [id])
  groups          Group[]
  categories      Category[]
  classifications Classification[]
  associations    Association[]
  users           User[]
}

model SMS {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  sentAt    DateTime @db.Timestamptz(6)
  tenancyId String
  messageId String

  status SMSStatus @default(PROGRESS)
}

// model SystemEmail {
//   id        String    @id @default(uuid())
//   seq       Int       @unique @default(autoincrement())
//   createdAt DateTime  @default(now()) @db.Timestamptz(6)
//   updatedAt DateTime? @updatedAt @db.Timestamptz(6)
//   removedAt DateTime? @db.Timestamptz(6)

//   status     EmailStatus @default(PROGRESS)
//   messageId  String
//   templateId String
//   tenancyId  String
//   sentAt     DateTime    @db.Timestamptz(6)

//   template Template @relation(fields: [templateId], references: [id])
// }

// model Message {
//   id        String    @id @default(uuid())
//   seq       Int       @unique @default(autoincrement())
//   createdAt DateTime  @default(now()) @db.Timestamptz(6)
//   updatedAt DateTime? @updatedAt @db.Timestamptz(6)
//   removedAt DateTime? @db.Timestamptz(6)

//   toUserIds  String[]
//   fromUserId String
//   postId     String

//   post         Post          @relation(fields: [postId], references: [id])
//   systemEmails SystemEmail[]
// }

// 나눔 //
model Timeline {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  name      String    @unique
  tenancyId String
  tenantId  String
  sessions  Session[]
}

model Session {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  type               SessionTypes        @default(ONE_TIME)
  name               String
  timelineId         String?             @unique
  repeatCycleType    RepeatCycleTypes?
  startDateTime      DateTime?           @db.Timestamptz(6)
  endDateTime        DateTime?           @db.Timestamptz(6)
  recurringDayOfWeek RecurringDayOfWeek?
  recurringMonth     Int?

  timeline Timeline? @relation(fields: [timelineId], references: [id])
}

// 나눔 //
model Routine {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  name      String  @unique
  sessionId String?
  contentId String
  tenancyId String
}

model Sequence {
  id  String @id @default(uuid())
  seq Int    @unique @default(autoincrement())

  name      String @unique
  routineId String

  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)
}

//

model Role {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  name      Roles  @unique @default(USER)
  tenancyId String

  abilities      Ability[]
  classification Classification?
  tenants        Tenant[]
}

model Action {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  name       AbilityActions @default(CREATE)
  conditions Json?
  tenancyId  String
}

model Subject {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  name      String @unique
  tenancyId String
}

model Ability {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  type        AbilityTypes
  subjectId   String
  actionId    String
  roleId      String
  description String?
  conditions  Json?
  tenancyId   String

  role Role @relation(fields: [roleId], references: [id])
}

// model Template {
//   id           String        @id @default(uuid())
//   seq          Int           @unique @default(autoincrement())
//   name         TemplateNames @unique @default(WELCOME)
//   postId       String        @unique
//   createdAt    DateTime      @default(now()) @db.Timestamptz(6)
//   updatedAt    DateTime?     @updatedAt @db.Timestamptz(6)
//   removedAt    DateTime?     @db.Timestamptz(6)
//   systemEmails SystemEmail[]
//   post         Post          @relation(fields: [postId], references: [id])
// }

// model Qna {
//   id        String     @id @default(uuid())
//   seq       Int        @unique @default(autoincrement())
//   status    QnaStatus  @default(OPEN)
//   spaceId   String
//   createdAt DateTime   @default(now()) @db.Timestamptz(6)
//   updatedAt DateTime?  @updatedAt @db.Timestamptz(6)
//   removedAt DateTime?  @db.Timestamptz(6)
//   question  Question[]
// }

// model Question {
//   id        String    @id @default(uuid())
//   seq       Int       @unique @default(autoincrement())
//   postId    String    @unique
//   qnaId     String
//   spaceId   String
//   createdAt DateTime  @default(now()) @db.Timestamptz(6)
//   updatedAt DateTime? @updatedAt @db.Timestamptz(6)
//   removedAt DateTime? @db.Timestamptz(6)
//   answers   Answer[]
//   post      Post      @relation(fields: [postId], references: [id])
//   qna       Qna       @relation(fields: [qnaId], references: [id])
// }

// model Answer {
//   id         String    @id @default(uuid())
//   seq        Int       @unique @default(autoincrement())
//   questionId String
//   postId     String
//   spaceId    String
//   createdAt  DateTime  @default(now()) @db.Timestamptz(6)
//   updatedAt  DateTime? @updatedAt @db.Timestamptz(6)
//   removedAt  DateTime? @db.Timestamptz(6)
//   post       Post      @relation(fields: [postId], references: [id])
//   question   Question  @relation(fields: [questionId], references: [id])
// }

model Post {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  contentId String
  authorId  String
  tenancyId String
}

model Content {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)

  title       String?
  description String?
  dopotId     String
  type        TextTypes @default(HTML)
  text        String?   @db.VarChar(1000)
}

model Depot {
  id        String     @id @default(uuid())
  seq       Int        @unique @default(autoincrement())
  type      DepotTypes @default(LEAF)
  parentId  String?
  createdAt DateTime   @default(now())
  updatedAt DateTime?  @updatedAt @db.Timestamptz(6)
  removedAt DateTime?  @db.Timestamptz(6)
  files     File[]
  children  Depot[]    @relation("DepotToDepot")
  parent    Depot?     @relation("DepotToDepot", fields: [parentId], references: [id])
  profiles  Profile[]
}

model File {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  name      String
  depotId   String
  size      Int
  mimeType  String
  url       String
  tenancyId String
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)
  depot     Depot     @relation(fields: [depotId], references: [id])
}

// model Page {
//   id        String    @id @default(uuid())
//   seq       Int       @unique @default(autoincrement())
//   name      String    @unique
//   pathname  String    @unique
//   params    Json?
//   createdAt DateTime  @default(now())
//   updatedAt DateTime? @updatedAt @db.Timestamptz(6)
//   removedAt DateTime? @db.Timestamptz(6)
//   elements  Element[]
// }

// enum ElementTypes {
//   TABLE
//   BUTTON
//   INPUT
//   SELECT
//   TEXTAREA
//   TILE
// }

// model Element {
//   id        String       @id @default(uuid())
//   seq       Int          @unique @default(autoincrement())
//   label     String       @unique
//   pageId    String
//   type      ElementTypes @default(TABLE)
//   createdAt DateTime     @default(now())
//   updatedAt DateTime?    @updatedAt @db.Timestamptz(6)
//   removedAt DateTime?    @db.Timestamptz(6)
//   page      Page         @relation(fields: [pageId], references: [id])
// }

// enum PageTypes {
//   BOTTOM_TAB
//   TOP_TAB
//   BUTTON
//   MENU
//   LANDING
// }

enum EmailStatus {
  PROGRESS
  PENDING
  SENT
  FAILED
  COMPLETED
}

enum SMSStatus {
  PROGRESS
  PENDING
  SENT
  FAILED
}

enum ReservationStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

enum SessionTypes {
  ONE_TIME
  ONE_TIME_RANGE
  RECURRING
}

enum RepeatCycleTypes {
  WEEKLY
  MONTHLY
}

enum SessionEndTypes {
  NEVER
  ON_DATE
  AFTER_OCCURRENCES
}

enum RecurringDayOfWeek {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

enum AbilityActions {
  CREATE
  READ
  UPDATE
  DELETE
  ACCESS
}

enum AbilityTypes {
  CAN
  CAN_NOT
}

enum Roles {
  USER
  SUPER_ADMIN
  ADMIN
}

enum TemplateNames {
  WELCOME
  EMAIL_VERIFICATION
  RESET_PASSWORD
}

enum QnaStatus {
  OPEN
  CLOSED
}

enum TextTypes {
  HTML
  MARKDOWN
  STRING
}

enum CategoryTypes {
  LEAF
  ROOT
}

enum ServiceNames {
  USER
  SPACE
  POST
  ROLE
  TIMELINE
  ROUTINE
}

enum DepotTypes {
  ROOT
  LEAF
}
