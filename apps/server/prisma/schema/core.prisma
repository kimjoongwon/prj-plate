model Category {
  id        String        @id @default(uuid())
  seq       Int           @unique @default(autoincrement())
  name      String
  type      CategoryTypes @default(ROOT)
  parentId  String?
  serviceId String
  spaceId   String
  createdAt DateTime      @default(now()) @db.Timestamptz(6)
  updatedAt DateTime?     @updatedAt @db.Timestamptz(6)
  removedAt DateTime?     @db.Timestamptz(6)
  service   Service       @relation(fields: [serviceId], references: [id])
  space     Space         @relation(fields: [spaceId], references: [id])
  parent    Category?     @relation("CategoryToCategory", fields: [parentId], references: [id])
  children  Category[]    @relation("CategoryToCategory")
}

model Classification {
  id         String    @id @default(uuid())
  seq        Int       @unique @default(autoincrement())
  categoryId String
  userId     String?   @unique
  postId     String?   @unique
  spaceId    String?   @unique
  roleId     String?   @unique
  createdAt  DateTime  @default(now())
  updatedAt  DateTime? @updatedAt @db.Timestamptz(6)
  removedAt  DateTime? @db.Timestamptz(6)
  user       User?     @relation(fields: [userId], references: [id])
  post       Post?     @relation(fields: [postId], references: [id])
  space      Space?    @relation(fields: [spaceId], references: [id])
  role       Role?     @relation(fields: [roleId], references: [id])

  @@unique([categoryId, userId])
  @@unique([categoryId, postId])
  @@unique([categoryId, spaceId])
  @@unique([categoryId, roleId])
}

model Group {
  id          String        @id @default(uuid())
  seq         Int           @unique @default(autoincrement())
  name        String
  serviceId   String
  spaceId     String
  createdAt   DateTime      @default(now()) @db.Timestamptz(6)
  updatedAt   DateTime?     @updatedAt @db.Timestamptz(6)
  removedAt   DateTime?     @db.Timestamptz(6)
  service     Service       @relation(fields: [serviceId], references: [id])
  space       Space         @relation(fields: [spaceId], references: [id])
  association Association[]
}

model Service {
  id         String     @id @default(uuid())
  seq        Int        @unique @default(autoincrement())
  name       String     @unique
  label      String     @unique
  createdAt  DateTime   @default(now()) @db.Timestamptz(6)
  updatedAt  DateTime?  @updatedAt @db.Timestamptz(6)
  removedAt  DateTime?  @db.Timestamptz(6)
  groups     Group[]
  categories Category[]
}

model Association {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  groupId   String
  userId    String?
  postId    String?
  spaceId   String?
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)
  group     Group     @relation(fields: [groupId], references: [id])
  user      User?     @relation(fields: [userId], references: [id])
  post      Post?     @relation(fields: [postId], references: [id])
  space     Space?    @relation(fields: [spaceId], references: [id])
}

model Profile {
  id          String    @id @default(uuid())
  seq         Int       @unique @default(autoincrement())
  depotFileId String?
  nickname    String
  userId      String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime? @updatedAt @db.Timestamptz(6)
  removedAt   DateTime? @db.Timestamptz(6)
  user        User      @relation(fields: [userId], references: [id])
}

model User {
  id             String          @id @default(uuid())
  seq            Int             @unique @default(autoincrement())
  email          String          @unique
  name           String          @unique
  phone          String          @unique
  password       String
  spaceId        String
  updatedAt      DateTime?       @updatedAt @db.Timestamptz(6)
  createdAt      DateTime        @default(now()) @db.Timestamptz(6)
  removedAt      DateTime?       @db.Timestamptz(6)
  posts          Post[]
  profiles       Profile[]
  tenants        Tenant[]
  association    Association[]
  space          Space           @relation(fields: [spaceId], references: [id])
  classification Classification?
}

model Tenant {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  userId    String
  roleId    String
  spaceId   String
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)
  role      Role      @relation(fields: [roleId], references: [id])
  space     Space     @relation(fields: [spaceId], references: [id])
  user      User      @relation(fields: [userId], references: [id])
}

model Space {
  id             String          @id @default(uuid())
  seq            Int             @unique @default(autoincrement())
  name           String          @unique
  createdAt      DateTime        @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime?       @updatedAt @db.Timestamptz(6)
  removedAt      DateTime?       @db.Timestamptz(6)
  tenants        Tenant[]
  groups         Group[]
  categories     Category[]
  association    Association[]
  file           File[]
  classification Classification?
  users          User[]
}

model SMS {
  id         String    @id @default(uuid())
  seq        Int       @unique @default(autoincrement())
  toUserIds  String[]
  fromUserId String?
  spaceId    String
  status     SMSStatus @default(PROGRESS)
  sentAt     DateTime?
  createdAt  DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt  DateTime? @updatedAt @db.Timestamptz(6)
  removedAt  DateTime? @db.Timestamptz(6)
}

model SystemEmail {
  id         String      @id @default(uuid())
  seq        Int         @unique @default(autoincrement())
  status     EmailStatus @default(PROGRESS)
  emailId    String
  templateId String
  spaceId    String
  createdAt  DateTime    @default(now()) @db.Timestamptz(6)
  updatedAt  DateTime?   @updatedAt @db.Timestamptz(6)
  removedAt  DateTime?   @db.Timestamptz(6)
  email      Email       @relation(fields: [emailId], references: [id])
  template   Template    @relation(fields: [templateId], references: [id])
}

model Email {
  id           String        @id @default(uuid())
  seq          Int           @unique @default(autoincrement())
  toUserIds    String[]
  fromUserId   String
  sentAt       DateTime      @db.Timestamptz(6)
  createdAt    DateTime      @default(now()) @db.Timestamptz(6)
  updatedAt    DateTime?     @updatedAt @db.Timestamptz(6)
  removedAt    DateTime?     @db.Timestamptz(6)
  postId       String
  post         Post          @relation(fields: [postId], references: [id])
  systemEmails SystemEmail[]
}

model Timeline {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  spaceId   String
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)
  sessions  Session[]
}

model Session {
  id                    String                  @id @default(uuid())
  seq                   Int                     @unique @default(autoincrement())
  type                  SessionTypes            @default(ONE_TIME)
  startDate             DateTime                @db.Date
  endDate               DateTime?               @db.Date
  timelineId            String
  recurringDayOfTheWeek RecurringDayOfTheWeek[] @default([])
  repeatCycle           Int                     @default(1)
  repeatCycleType       RepeatCycleTypes        @default(WEEK)
  createdAt             DateTime                @default(now()) @db.Timestamptz(6)
  updatedAt             DateTime?               @updatedAt @db.Timestamptz(6)
  removedAt             DateTime?               @db.Timestamptz(6)
  timeline              Timeline                @relation(fields: [timelineId], references: [id])
  timelineItems         TimelineItem[]
}

model TimelineItem {
  id            String    @id @default(uuid())
  seq           Int       @unique @default(autoincrement())
  sessionId     String
  startDateTime DateTime  @db.Timestamptz(6)
  endDateTime   DateTime  @db.Timestamptz(6)
  createdAt     DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt     DateTime? @updatedAt @db.Timestamptz(6)
  removedAt     DateTime? @db.Timestamptz(6)
  session       Session   @relation(fields: [sessionId], references: [id])
}

model Role {
  id             String          @id @default(uuid())
  seq            Int             @unique @default(autoincrement())
  name           Roles           @unique @default(USER)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime?       @updatedAt @db.Timestamptz(6)
  removedAt      DateTime?       @db.Timestamptz(6)
  abilities      Ability[]
  tenant         Tenant[]
  classification Classification?
}

model Action {
  id         String         @id @default(uuid())
  seq        Int            @unique @default(autoincrement())
  name       AbilityActions @default(CREATE)
  conditions Json?
  subjectId  String
  createdAt  DateTime       @default(now())
  updatedAt  DateTime?      @updatedAt @db.Timestamptz(6)
  removedAt  DateTime?      @db.Timestamptz(6)
  subject    Subject        @relation(fields: [subjectId], references: [id])
}

model Subject {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  name      String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)
  abilities Ability[]
  actions   Action[]
}

model Ability {
  id          String       @id @default(uuid())
  seq         Int          @unique @default(autoincrement())
  type        AbilityTypes
  roleId      String
  subjectId   String
  description String?
  conditions  Json?
  createdAt   DateTime     @default(now()) @db.Timestamptz(6)
  updatedAt   DateTime?    @updatedAt @db.Timestamptz(6)
  removedAt   DateTime?    @db.Timestamptz(6)
  role        Role         @relation(fields: [roleId], references: [id])
  subject     Subject      @relation(fields: [subjectId], references: [id])
}

model Template {
  id           String        @id @default(uuid())
  seq          Int           @unique @default(autoincrement())
  name         TemplateNames @unique @default(WELCOME)
  postId       String        @unique
  createdAt    DateTime      @default(now()) @db.Timestamptz(6)
  updatedAt    DateTime?     @updatedAt @db.Timestamptz(6)
  removedAt    DateTime?     @db.Timestamptz(6)
  systemEmails SystemEmail[]
  post         Post          @relation(fields: [postId], references: [id])
}

model Qna {
  id        String     @id @default(uuid())
  seq       Int        @unique @default(autoincrement())
  status    QnaStatus  @default(OPEN)
  spaceId   String
  createdAt DateTime   @default(now()) @db.Timestamptz(6)
  updatedAt DateTime?  @updatedAt @db.Timestamptz(6)
  removedAt DateTime?  @db.Timestamptz(6)
  question  Question[]
}

model Question {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  postId    String    @unique
  qnaId     String
  spaceId   String
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)
  answers   Answer[]
  post      Post      @relation(fields: [postId], references: [id])
  qna       Qna       @relation(fields: [qnaId], references: [id])
}

model Answer {
  id         String    @id @default(uuid())
  seq        Int       @unique @default(autoincrement())
  questionId String
  postId     String
  spaceId    String
  createdAt  DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt  DateTime? @updatedAt @db.Timestamptz(6)
  removedAt  DateTime? @db.Timestamptz(6)
  post       Post      @relation(fields: [postId], references: [id])
  question   Question  @relation(fields: [questionId], references: [id])
}

model Post {
  id             String          @id @default(uuid())
  seq            Int             @unique @default(autoincrement())
  type           PostTypes       @default(TEXT)
  title          String?
  description    String?
  content        String          @db.VarChar(1000)
  dopotId        String
  authorId       String
  spaceId        String
  createdAt      DateTime        @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime?       @updatedAt @db.Timestamptz(6)
  removedAt      DateTime?       @db.Timestamptz(6)
  answers        Answer[]
  emails         Email[]
  author         User            @relation(fields: [authorId], references: [id])
  question       Question?
  template       Template?
  exercise       Exercise?
  association    Association[]
  classification Classification?
}

model Depot {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)
  File      File[]
}

model File {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  name      String
  depotId   String
  size      Int
  mimeType  String
  url       String
  spaceId   String
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)
  depot     Depot     @relation(fields: [depotId], references: [id])
  space     Space     @relation(fields: [spaceId], references: [id])
}

model Page {
  id        String    @id @default(uuid())
  seq       Int       @unique @default(autoincrement())
  name      String    @unique
  pathname  String    @unique
  params    Json?
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt @db.Timestamptz(6)
  removedAt DateTime? @db.Timestamptz(6)
  elements  Element[]
}

enum ElementTypes {
  TABLE
  BUTTON
  INPUT
  SELECT
  TEXTAREA
  TILE
}

model Element {
  id        String       @id @default(uuid())
  seq       Int          @unique @default(autoincrement())
  label     String       @unique
  pageId    String
  type      ElementTypes @default(TABLE)
  createdAt DateTime     @default(now())
  updatedAt DateTime?    @updatedAt @db.Timestamptz(6)
  removedAt DateTime?    @db.Timestamptz(6)
  page      Page         @relation(fields: [pageId], references: [id])
}

enum PageTypes {
  BOTTOM_TAB
  TOP_TAB
  BUTTON
  MENU
  LANDING
}

enum TenantTypes {
  PHYSICAL
  ABSTRACT
}

enum EmailStatus {
  PROGRESS
  PENDING
  SENT
  FAILED
  COMPLETED
}

enum SMSStatus {
  PROGRESS
  PENDING
  SENT
  FAILED
}

enum ReservationStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

enum SessionTypes {
  ONE_TIME
  ONE_TIME_RANGE
  RECURRING
}

enum RepeatCycleTypes {
  WEEK
  MONTH
  YEAR
}

enum SessionEndTypes {
  NEVER
  ON_DATE
  AFTER_OCCURRENCES
}

enum RecurringDayOfTheWeek {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

enum AbilityActions {
  CREATE
  READ
  UPDATE
  DELETE
  ACCESS
}

enum AbilityTypes {
  CAN
  CAN_NOT
}

enum Roles {
  USER
  SUPER_ADMIN
  ADMIN
}

enum TemplateNames {
  WELCOME
  EMAIL_VERIFICATION
  RESET_PASSWORD
}

enum QnaStatus {
  OPEN
  CLOSED
}

enum PostTypes {
  HTML
  TEXT
}

enum CategoryTypes {
  LEAF
  ROOT
}
