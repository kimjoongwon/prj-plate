# ğŸ“‹ AdminTemplateManagement í™”ë©´ ê¸°íšì„œ

**í”Œë«í¼:** Admin Web

## 1. í™”ë©´ ê°œìš”

### ëª©ì 
ê´€ë¦¬ìê°€ ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš©í•˜ëŠ” ê°ì¢… í…œí”Œë¦¿(ì´ë©”ì¼, SMS, í‘¸ì‹œ, HTML)ì„ ê´€ë¦¬í•˜ëŠ” í™”ë©´ì…ë‹ˆë‹¤. ì´ë©”ì¼ ì¸ì¦, íšŒì› íƒˆí‡´, ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë“± ë‹¤ì–‘í•œ ìƒí™©ì—ì„œ ì‚¬ìš©ë˜ëŠ” í…œí”Œë¦¿ì„ ìƒì„±, ìˆ˜ì •, ë¯¸ë¦¬ë³´ê¸°, í…ŒìŠ¤íŠ¸ ë°œì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì§„ì… ì¡°ê±´
- ê´€ë¦¬ì ë¡œê·¸ì¸ ì™„ë£Œ
- `menu:templates` Subject ì ‘ê·¼ ê¶Œí•œ ë³´ìœ 

### ì´íƒˆ ì¡°ê±´
- ë‹¤ë¥¸ ë©”ë‰´ë¡œ ì´ë™
- ë¡œê·¸ì•„ì›ƒ

---

## 2. í™”ë©´ êµ¬ì¡°

### ë ˆì´ì•„ì›ƒ (Admin Web)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [AdminLayout Header]                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì´ë©”ì¼ í…œí”Œë¦¿ â”‚ SMS í…œí”Œë¦¿ â”‚ í‘¸ì‹œ í…œí”Œë¦¿ â”‚ HTML í…œí”Œë¦¿          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   í…œí”Œë¦¿ ëª©ë¡       â”‚  â”‚      í…œí”Œë¦¿ í¸ì§‘/ë¯¸ë¦¬ë³´ê¸°         â”‚  â”‚
â”‚  â”‚                    â”‚  â”‚                                  â”‚  â”‚
â”‚  â”‚  â–¡ ì´ë©”ì¼ ì¸ì¦     â”‚  â”‚  í…œí”Œë¦¿ ì´ë¦„: [________]         â”‚  â”‚
â”‚  â”‚  â–¡ ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •  â”‚  â”‚                                  â”‚  â”‚
â”‚  â”‚  â–¡ íšŒì› íƒˆí‡´ ì•ˆë‚´  â”‚  â”‚  ì œëª©: [__________________]      â”‚  â”‚
â”‚  â”‚  â–¡ ì˜ˆì•½ í™•ì¸      â”‚  â”‚                                  â”‚  â”‚
â”‚  â”‚  â–¡ ì˜ˆì•½ ì·¨ì†Œ      â”‚  â”‚  ë‚´ìš©:                           â”‚  â”‚
â”‚  â”‚  ...              â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚                    â”‚  â”‚  â”‚                            â”‚  â”‚  â”‚
â”‚  â”‚  [+ ìƒˆ í…œí”Œë¦¿]     â”‚  â”‚  â”‚  [ì—ë””í„° ì˜ì—­]              â”‚  â”‚  â”‚
â”‚  â”‚                    â”‚  â”‚  â”‚                            â”‚  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚                            â”‚  â”‚  â”‚
â”‚                          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚                          â”‚                                  â”‚  â”‚
â”‚                          â”‚  [ë¯¸ë¦¬ë³´ê¸°] [í…ŒìŠ¤íŠ¸ ë°œì†¡] [ì €ì¥]  â”‚  â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì»´í¬ë„ŒíŠ¸ êµ¬ì„±

| ì˜ì—­ | ì»´í¬ë„ŒíŠ¸ | ì„¤ëª… |
|------|----------|------|
| Tab Navigation | Tabs (HeroUI) | í…œí”Œë¦¿ íƒ€ì…ë³„ íƒ­ |
| Left Panel | TemplateList | í…œí”Œë¦¿ ëª©ë¡ ë° ì„ íƒ |
| Right Panel | TemplateEditor | í…œí”Œë¦¿ í¸ì§‘ ì˜ì—­ |
| Right Panel | TemplatePreview | í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸° |
| Action Buttons | Button Group | ë¯¸ë¦¬ë³´ê¸°, í…ŒìŠ¤íŠ¸ ë°œì†¡, ì €ì¥ ë²„íŠ¼ |

---

## 3. ë°ì´í„° ìš”êµ¬ì‚¬í•­

### í•„ìš”í•œ API

| Method | Endpoint | ì„¤ëª… | ì¸ì¦ |
|--------|----------|------|------|
| GET | /api/v1/admin/templates | í…œí”Œë¦¿ ëª©ë¡ ì¡°íšŒ | Admin Token |
| GET | /api/v1/admin/templates/:id | í…œí”Œë¦¿ ìƒì„¸ ì¡°íšŒ | Admin Token |
| POST | /api/v1/admin/templates | í…œí”Œë¦¿ ìƒì„± | Admin Token |
| PUT | /api/v1/admin/templates/:id | í…œí”Œë¦¿ ìˆ˜ì • | Admin Token |
| DELETE | /api/v1/admin/templates/:id | í…œí”Œë¦¿ ì‚­ì œ | Admin Token |
| POST | /api/v1/admin/templates/:id/test | í…ŒìŠ¤íŠ¸ ë°œì†¡ | Admin Token |
| POST | /api/v1/admin/templates/:id/preview | ë¯¸ë¦¬ë³´ê¸° ë Œë”ë§ | Admin Token |

### API ì‘ë‹µ ì˜ˆì‹œ

**GET /api/v1/admin/templates**
```json
{
  "data": [
    {
      "id": "template-uuid-1",
      "name": "ì´ë©”ì¼ ì¸ì¦",
      "type": "EMAIL",
      "key": "email_verification",
      "subject": "ì´ë©”ì¼ ì¸ì¦ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”",
      "content": "<!DOCTYPE html>...",
      "variables": ["userName", "verificationCode", "expiresAt"],
      "isActive": true,
      "createdAt": "2025-01-01T00:00:00Z",
      "updatedAt": "2025-01-01T00:00:00Z"
    }
  ],
  "meta": {
    "total": 20,
    "page": 1,
    "limit": 20
  }
}
```

**POST /api/v1/admin/templates/:id/test**
```json
{
  "recipient": "test@example.com",
  "variables": {
    "userName": "í™ê¸¸ë™",
    "verificationCode": "123456",
    "expiresAt": "2025-01-01 12:00:00"
  }
}
```

### í•„ìš”í•œ ìƒíƒœ

| ìƒíƒœ | íƒ€ì… | ì„¤ëª… | ì´ˆê¸°ê°’ |
|------|------|------|--------|
| selectedTab | TemplateType | ì„ íƒëœ í…œí”Œë¦¿ íƒ€ì… | 'EMAIL' |
| templates | Template[] | í…œí”Œë¦¿ ëª©ë¡ | [] |
| selectedTemplateId | string \| null | ì„ íƒëœ í…œí”Œë¦¿ ID | null |
| selectedTemplate | Template \| null | ì„ íƒëœ í…œí”Œë¦¿ ìƒì„¸ | null |
| isEditing | boolean | í¸ì§‘ ëª¨ë“œ ì—¬ë¶€ | false |
| previewHtml | string | ë¯¸ë¦¬ë³´ê¸° HTML | "" |
| isLoading | boolean | ë¡œë”© ìƒíƒœ | false |
| isSaving | boolean | ì €ì¥ ì¤‘ ìƒíƒœ | false |
| isSendingTest | boolean | í…ŒìŠ¤íŠ¸ ë°œì†¡ ì¤‘ | false |

### íƒ€ì… ì •ì˜

```typescript
enum TemplateType {
  EMAIL = 'EMAIL',
  SMS = 'SMS',
  PUSH = 'PUSH',
  HTML = 'HTML',
}

interface Template {
  id: string;
  name: string;
  type: TemplateType;
  key: string; // ì‹œìŠ¤í…œ ë‚´ë¶€ í‚¤ (email_verification, password_reset ë“±)
  subject?: string; // ì´ë©”ì¼/í‘¸ì‹œ ì œëª©
  content: string; // í…œí”Œë¦¿ ë‚´ìš© (HTML/Text)
  variables: string[]; // ì‚¬ìš© ê°€ëŠ¥í•œ ë³€ìˆ˜ ëª©ë¡
  isActive: boolean;
  createdAt: string;
  updatedAt: string;
}

interface TemplateVariable {
  name: string;
  description: string;
  example: string;
}
```

### í…œí”Œë¦¿ ë³€ìˆ˜ ì˜ˆì‹œ

**ì´ë©”ì¼ ì¸ì¦ í…œí”Œë¦¿:**
```typescript
const emailVerificationVariables: TemplateVariable[] = [
  { name: 'userName', description: 'ì‚¬ìš©ì ì´ë¦„', example: 'í™ê¸¸ë™' },
  { name: 'verificationCode', description: 'ì¸ì¦ ì½”ë“œ', example: '123456' },
  { name: 'expiresAt', description: 'ë§Œë£Œ ì‹œê°„', example: '2025-01-01 12:00' },
  { name: 'verificationLink', description: 'ì¸ì¦ ë§í¬', example: 'https://example.com/verify?code=xxx' },
];
```

**íšŒì› íƒˆí‡´ í…œí”Œë¦¿:**
```typescript
const withdrawalVariables: TemplateVariable[] = [
  { name: 'userName', description: 'ì‚¬ìš©ì ì´ë¦„', example: 'í™ê¸¸ë™' },
  { name: 'withdrawalDate', description: 'íƒˆí‡´ ì²˜ë¦¬ ì¼ì‹œ', example: '2025-01-01' },
  { name: 'dataRetentionPeriod', description: 'ë°ì´í„° ë³´ê´€ ê¸°ê°„', example: '30ì¼' },
];
```

---

## 4. ì¸í„°ë™ì…˜ ì •ì˜

### ì‚¬ìš©ì ì•¡ì…˜

| ì•¡ì…˜ | íŠ¸ë¦¬ê±° | ê²°ê³¼ |
|------|--------|------|
| íƒ­ ë³€ê²½ | ìƒë‹¨ íƒ­ í´ë¦­ | í•´ë‹¹ íƒ€ì…ì˜ í…œí”Œë¦¿ ëª©ë¡ ì¡°íšŒ ë° í‘œì‹œ |
| í…œí”Œë¦¿ ì„ íƒ | ì¢Œì¸¡ ëª©ë¡ì—ì„œ í…œí”Œë¦¿ í´ë¦­ | í…œí”Œë¦¿ ìƒì„¸ ì¡°íšŒ ë° í¸ì§‘ ì˜ì—­ í‘œì‹œ |
| ìƒˆ í…œí”Œë¦¿ ìƒì„± | [+ ìƒˆ í…œí”Œë¦¿] ë²„íŠ¼ í´ë¦­ | ë¹ˆ í¸ì§‘ í¼ í‘œì‹œ |
| í…œí”Œë¦¿ í¸ì§‘ | ì—ë””í„° ì˜ì—­ ìˆ˜ì • | isEditing = true |
| ë¯¸ë¦¬ë³´ê¸° | [ë¯¸ë¦¬ë³´ê¸°] ë²„íŠ¼ í´ë¦­ | í˜„ì¬ í…œí”Œë¦¿ ë Œë”ë§í•˜ì—¬ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ |
| í…ŒìŠ¤íŠ¸ ë°œì†¡ | [í…ŒìŠ¤íŠ¸ ë°œì†¡] ë²„íŠ¼ í´ë¦­ | ëª¨ë‹¬ ì—´ë¦¼ (ìˆ˜ì‹ ì ì…ë ¥) â†’ í…ŒìŠ¤íŠ¸ ë°œì†¡ |
| ì €ì¥ | [ì €ì¥] ë²„íŠ¼ í´ë¦­ | POST/PUT API í˜¸ì¶œí•˜ì—¬ ì €ì¥ |
| ì‚­ì œ | [ì‚­ì œ] ë²„íŠ¼ í´ë¦­ | í™•ì¸ ëª¨ë‹¬ â†’ DELETE API í˜¸ì¶œ |

### í•¸ë“¤ëŸ¬ ì •ì˜

| í•¸ë“¤ëŸ¬ | íŒŒë¼ë¯¸í„° | ë™ì‘ |
|--------|----------|------|
| onChangeTab | type: TemplateType | íƒ­ ë³€ê²½, í•´ë‹¹ íƒ€ì… í…œí”Œë¦¿ ëª©ë¡ ì¡°íšŒ |
| onSelectTemplate | templateId: string | í…œí”Œë¦¿ ìƒì„¸ ì¡°íšŒ |
| onCreateTemplate | - | ìƒˆ í…œí”Œë¦¿ í¼ ì´ˆê¸°í™” |
| onChangeTemplate | field: string, value: any | í…œí”Œë¦¿ í•„ë“œ ì—…ë°ì´íŠ¸ |
| onClickPreview | - | ë¯¸ë¦¬ë³´ê¸° API í˜¸ì¶œ |
| onClickTestSend | - | í…ŒìŠ¤íŠ¸ ë°œì†¡ ëª¨ë‹¬ ì—´ê¸° |
| onSendTest | recipient: string, variables: Record<string, any> | í…ŒìŠ¤íŠ¸ ë°œì†¡ API í˜¸ì¶œ |
| onSaveTemplate | - | ìƒì„±/ìˆ˜ì • API í˜¸ì¶œ |
| onDeleteTemplate | templateId: string | ì‚­ì œ API í˜¸ì¶œ |

### ìƒíƒœ ë³€í™” íë¦„

```
í˜ì´ì§€ ì§„ì…
    â†“
selectedTab = 'EMAIL'
isLoading = true
    â†“
API í˜¸ì¶œ (GET /api/v1/admin/templates?type=EMAIL)
    â†“
templates = response.data, isLoading = false
    â†“
ì‚¬ìš©ìê°€ í…œí”Œë¦¿ ì„ íƒ
    â†“
selectedTemplateId = clickedId
API í˜¸ì¶œ (GET /api/v1/admin/templates/:id)
    â†“
selectedTemplate = response.data
    â†“
ì‚¬ìš©ìê°€ í…œí”Œë¦¿ ìˆ˜ì •
    â†“
isEditing = true
    â†“
[ì €ì¥] ë²„íŠ¼ í´ë¦­
    â†“
isSaving = true
API í˜¸ì¶œ (PUT /api/v1/admin/templates/:id)
    â†“
ì„±ê³µ â†’ selectedTemplate ì—…ë°ì´íŠ¸, isEditing = false, isSaving = false
ì‹¤íŒ¨ â†’ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ, isSaving = false
```

---

## 5. UI ìƒì„¸

### í…œí”Œë¦¿ íƒ€ì…ë³„ íƒ­

- EMAIL, SMS, PUSH, HTML 4ê°œ íƒ­
- ì„ íƒëœ íƒ­ ê°•ì¡° í‘œì‹œ
- íƒ­ ë³€ê²½ ì‹œ í•´ë‹¹ íƒ€ì…ì˜ í…œí”Œë¦¿ ëª©ë¡ ìë™ ë¡œë“œ

### í…œí”Œë¦¿ ëª©ë¡ (ì¢Œì¸¡ íŒ¨ë„)

**í‘œì‹œ ì •ë³´:**
- í…œí”Œë¦¿ ì´ë¦„
- í…œí”Œë¦¿ í‚¤ (key) - ë¶€ì œëª© ìŠ¤íƒ€ì¼
- í™œì„±í™” ìƒíƒœ (Badge: Active/Inactive)

**ì •ë ¬:**
- ìƒì„±ì¼ ìµœì‹ ìˆœ

**ì•¡ì…˜:**
- [+ ìƒˆ í…œí”Œë¦¿] ë²„íŠ¼ (ëª©ë¡ í•˜ë‹¨)

### í…œí”Œë¦¿ í¸ì§‘ ì˜ì—­ (ìš°ì¸¡ íŒ¨ë„)

**ì´ë©”ì¼ í…œí”Œë¦¿:**
- í…œí”Œë¦¿ ì´ë¦„ ì…ë ¥
- í…œí”Œë¦¿ í‚¤ ì…ë ¥ (ê³ ìœ ê°’)
- ì œëª© ì…ë ¥
- HTML ì—ë””í„° (Rich Text Editor ë˜ëŠ” Code Editor)
- ì‚¬ìš© ê°€ëŠ¥í•œ ë³€ìˆ˜ ëª©ë¡ í‘œì‹œ

**SMS í…œí”Œë¦¿:**
- í…œí”Œë¦¿ ì´ë¦„ ì…ë ¥
- í…œí”Œë¦¿ í‚¤ ì…ë ¥
- ë‚´ìš© ì…ë ¥ (Text Area, ìµœëŒ€ 90ì)
- ê¸€ì ìˆ˜ ì¹´ìš´í„°
- ì‚¬ìš© ê°€ëŠ¥í•œ ë³€ìˆ˜ ëª©ë¡ í‘œì‹œ

**í‘¸ì‹œ í…œí”Œë¦¿:**
- í…œí”Œë¦¿ ì´ë¦„ ì…ë ¥
- í…œí”Œë¦¿ í‚¤ ì…ë ¥
- ì œëª© ì…ë ¥ (ìµœëŒ€ 50ì)
- ë‚´ìš© ì…ë ¥ (ìµœëŒ€ 100ì)
- ì‚¬ìš© ê°€ëŠ¥í•œ ë³€ìˆ˜ ëª©ë¡ í‘œì‹œ

**HTML í…œí”Œë¦¿:**
- í…œí”Œë¦¿ ì´ë¦„ ì…ë ¥
- í…œí”Œë¦¿ í‚¤ ì…ë ¥
- HTML Code Editor
- ì‚¬ìš© ê°€ëŠ¥í•œ ë³€ìˆ˜ ëª©ë¡ í‘œì‹œ

### ë³€ìˆ˜ ì‚¬ìš© ê°€ì´ë“œ

**ë³€ìˆ˜ ëª©ë¡ í‘œì‹œ:**
```
ì‚¬ìš© ê°€ëŠ¥í•œ ë³€ìˆ˜:
- {{userName}} : ì‚¬ìš©ì ì´ë¦„ (ì˜ˆ: í™ê¸¸ë™)
- {{verificationCode}} : ì¸ì¦ ì½”ë“œ (ì˜ˆ: 123456)
- {{expiresAt}} : ë§Œë£Œ ì‹œê°„ (ì˜ˆ: 2025-01-01 12:00)
```

**ë³€ìˆ˜ ì‚½ì…:**
- ë³€ìˆ˜ í´ë¦­ ì‹œ ì—ë””í„° ì»¤ì„œ ìœ„ì¹˜ì— ìë™ ì‚½ì…

### ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬

**êµ¬ì¡°:**
- ëª¨ë‹¬ í—¤ë”: "í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸°"
- ëª¨ë‹¬ ë°”ë””: ë Œë”ë§ëœ í…œí”Œë¦¿ (iframe ë˜ëŠ” div)
- ë³€ìˆ˜ ì…ë ¥ í¼ (ë¯¸ë¦¬ë³´ê¸°ìš© ìƒ˜í”Œ ë°ì´í„°)

### í…ŒìŠ¤íŠ¸ ë°œì†¡ ëª¨ë‹¬

**êµ¬ì¡°:**
- ëª¨ë‹¬ í—¤ë”: "í…ŒìŠ¤íŠ¸ ë°œì†¡"
- ìˆ˜ì‹ ì ì…ë ¥ (ì´ë©”ì¼/SMS/í‘¸ì‹œ íƒ€ì…ì— ë”°ë¼ ë‹¬ë¼ì§)
- ë³€ìˆ˜ ê°’ ì…ë ¥ í¼
- [ë°œì†¡] [ì·¨ì†Œ] ë²„íŠ¼

---

## 6. ê¸°ì¡´ ì»´í¬ë„ŒíŠ¸ í™œìš© ì œì•ˆ

### ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ì¡´ ì»´í¬ë„ŒíŠ¸

| ì»´í¬ë„ŒíŠ¸ | ìš©ë„ | ê²½ë¡œ |
|----------|------|------|
| Tabs (HeroUI) | í…œí”Œë¦¿ íƒ€ì… íƒ­ | @heroui/react |
| Card (HeroUI) | í…œí”Œë¦¿ ëª©ë¡ ì¹´ë“œ | @heroui/react |
| Input (HeroUI) | ì…ë ¥ í•„ë“œ | @heroui/react |
| Textarea (HeroUI) | í…ìŠ¤íŠ¸ ì˜ì—­ | @heroui/react |
| Button (HeroUI) | ë²„íŠ¼ | @heroui/react |
| Modal (HeroUI) | ëª¨ë‹¬ | @heroui/react |
| Badge (HeroUI) | ìƒíƒœ ë°°ì§€ | @heroui/react |
| VStack | ìˆ˜ì§ ì •ë ¬ | components/ui/surfaces/VStack |
| HStack | ìˆ˜í‰ ì •ë ¬ | components/ui/surfaces/HStack |

### ì‹ ê·œ ì»´í¬ë„ŒíŠ¸ í•„ìš” ì—¬ë¶€
- [x] í•„ìš”í•¨ â†’ ì•„ë˜ ëª…ì„¸ ì°¸ê³ 

### ì‹ ê·œ ì»´í¬ë„ŒíŠ¸ ëª…ì„¸

---
**TemplateListItem ì»´í¬ë„ŒíŠ¸ë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”.**

**Props:**
- template: Template (í…œí”Œë¦¿ ë°ì´í„°)
- isSelected: boolean (ì„ íƒ ì—¬ë¶€)
- onPress?: (template: Template) => void (í´ë¦­ í•¸ë“¤ëŸ¬)

**í‘œì‹œ ë‚´ìš©:**
- í…œí”Œë¦¿ ì´ë¦„ (name)
- í…œí”Œë¦¿ í‚¤ (key) - ë¶€ì œëª© ìŠ¤íƒ€ì¼
- í™œì„±í™” ìƒíƒœ Badge

**ì¹´í…Œê³ ë¦¬:** admin
**Storybook:** í•„ìš”
**ê²½ë¡œ:** packages/ui/src/components/admin/TemplateListItem/TemplateListItem.tsx

---

---
**TemplateEditor ì»´í¬ë„ŒíŠ¸ë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”.**

**Props:**
- template: Template | null (í…œí”Œë¦¿ ë°ì´í„°)
- templateType: TemplateType (í…œí”Œë¦¿ íƒ€ì…)
- variables: TemplateVariable[] (ì‚¬ìš© ê°€ëŠ¥í•œ ë³€ìˆ˜)
- onChange: (field: string, value: any) => void (ë³€ê²½ í•¸ë“¤ëŸ¬)
- onPreview: () => void (ë¯¸ë¦¬ë³´ê¸° í•¸ë“¤ëŸ¬)
- onTestSend: () => void (í…ŒìŠ¤íŠ¸ ë°œì†¡ í•¸ë“¤ëŸ¬)
- onSave: () => void (ì €ì¥ í•¸ë“¤ëŸ¬)
- isSaving: boolean (ì €ì¥ ì¤‘ ìƒíƒœ)

**í‘œì‹œ ë‚´ìš©:**
- í…œí”Œë¦¿ íƒ€ì…ì— ë”°ë¥¸ ì…ë ¥ í¼
- ë³€ìˆ˜ ê°€ì´ë“œ íŒ¨ë„
- ì•¡ì…˜ ë²„íŠ¼ (ë¯¸ë¦¬ë³´ê¸°, í…ŒìŠ¤íŠ¸ ë°œì†¡, ì €ì¥)

**ì¹´í…Œê³ ë¦¬:** admin
**Storybook:** í•„ìš”
**ê²½ë¡œ:** packages/ui/src/components/admin/TemplateEditor/TemplateEditor.tsx

---

---
**TemplatePreviewModal ì»´í¬ë„ŒíŠ¸ë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”.**

**Props:**
- isOpen: boolean (ëª¨ë‹¬ ì—´ë¦¼ ìƒíƒœ)
- onClose: () => void (ë‹«ê¸° í•¸ë“¤ëŸ¬)
- previewHtml: string (ë¯¸ë¦¬ë³´ê¸° HTML)
- variables: TemplateVariable[] (ë³€ìˆ˜ ëª©ë¡)
- onRender: (variables: Record<string, any>) => void (ë Œë”ë§ í•¸ë“¤ëŸ¬)

**í‘œì‹œ ë‚´ìš©:**
- ë³€ìˆ˜ ê°’ ì…ë ¥ í¼
- ë Œë”ë§ëœ í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸°

**ì¹´í…Œê³ ë¦¬:** admin
**Storybook:** í•„ìš”
**ê²½ë¡œ:** packages/ui/src/components/admin/TemplatePreviewModal/TemplatePreviewModal.tsx

---

---

## 7. í˜ì´ì§€ ë¹Œë” ì „ë‹¬ ë‚´ìš©

### í˜ì´ì§€-ë¹Œë”ì—ê²Œ ìš”ì²­í•  ë‚´ìš©

---
**AdminTemplateManagementPageë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”.**

**ê¸°ëŠ¥:**
- í…œí”Œë¦¿ íƒ€ì…ë³„ íƒ­ (EMAIL, SMS, PUSH, HTML)
- í…œí”Œë¦¿ ëª©ë¡ ì¡°íšŒ ë° í‘œì‹œ
- í…œí”Œë¦¿ ì„ íƒ ì‹œ ìƒì„¸ ì¡°íšŒ
- í…œí”Œë¦¿ ìƒì„±/ìˆ˜ì •/ì‚­ì œ
- ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥
- í…ŒìŠ¤íŠ¸ ë°œì†¡ ê¸°ëŠ¥

**í•„ìš”í•œ ìƒíƒœ:**
- selectedTab: TemplateType
- templates: Template[]
- selectedTemplateId: string | null
- selectedTemplate: Template | null
- isEditing: boolean
- previewHtml: string
- isLoading: boolean
- isSaving: boolean

**í•„ìš”í•œ í•¸ë“¤ëŸ¬:**
- onChangeTab(type: TemplateType): íƒ­ ë³€ê²½
- onSelectTemplate(templateId: string): í…œí”Œë¦¿ ì„ íƒ
- onCreateTemplate(): ìƒˆ í…œí”Œë¦¿ ìƒì„±
- onChangeTemplate(field: string, value: any): í…œí”Œë¦¿ ìˆ˜ì •
- onPreview(): ë¯¸ë¦¬ë³´ê¸°
- onTestSend(recipient: string, variables: Record<string, any>): í…ŒìŠ¤íŠ¸ ë°œì†¡
- onSaveTemplate(): ì €ì¥
- onDeleteTemplate(templateId: string): ì‚­ì œ

**í˜ì´ì§€ ê²½ë¡œ:** /admin/templates/:type (email, sms, push, html)

**ë ˆì´ì•„ì›ƒ:** AdminLayout ì‚¬ìš©
---

---

## 8. ë°±ì—”ë“œ ë¹Œë” ì „ë‹¬ ë‚´ìš©

### ë°±ì—”ë“œ-ë¹Œë”ì—ê²Œ ìš”ì²­í•  ë‚´ìš©

---
**í…œí”Œë¦¿ ê´€ë¦¬ APIë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”.**

**ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡:**

1. **GET /api/v1/admin/templates**
   - Query: `type` (EMAIL|SMS|PUSH|HTML), `page`, `limit`
   - í…œí”Œë¦¿ ëª©ë¡ ì¡°íšŒ

2. **GET /api/v1/admin/templates/:id**
   - í…œí”Œë¦¿ ìƒì„¸ ì¡°íšŒ

3. **POST /api/v1/admin/templates**
   - Body: `name`, `type`, `key`, `subject`, `content`, `variables`
   - í…œí”Œë¦¿ ìƒì„±

4. **PUT /api/v1/admin/templates/:id**
   - Body: `name`, `subject`, `content`, `isActive`
   - í…œí”Œë¦¿ ìˆ˜ì •

5. **DELETE /api/v1/admin/templates/:id**
   - í…œí”Œë¦¿ ì‚­ì œ (soft delete)

6. **POST /api/v1/admin/templates/:id/preview**
   - Body: `variables` (Record<string, any>)
   - í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸° ë Œë”ë§

7. **POST /api/v1/admin/templates/:id/test**
   - Body: `recipient`, `variables`
   - í…ŒìŠ¤íŠ¸ ë°œì†¡

**ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§:**
- í…œí”Œë¦¿ keyëŠ” ê³ ìœ ê°’ (unique constraint)
- í…œí”Œë¦¿ ë³€ìˆ˜ëŠ” JSON ë°°ì—´ë¡œ ì €ì¥
- ë¯¸ë¦¬ë³´ê¸°: Handlebars ë˜ëŠ” EJSë¡œ ë³€ìˆ˜ ì¹˜í™˜
- í…ŒìŠ¤íŠ¸ ë°œì†¡: ì‹¤ì œ ì´ë©”ì¼/SMS/í‘¸ì‹œ ë°œì†¡ (í…ŒìŠ¤íŠ¸ ëª¨ë“œ)

**ì—ëŸ¬ ì²˜ë¦¬:**
- 401: ì¸ì¦ ì‹¤íŒ¨
- 403: ê¶Œí•œ ì—†ìŒ
- 404: í…œí”Œë¦¿ ì—†ìŒ
- 409: ì¤‘ë³µëœ key
- 500: ì„œë²„ ì—ëŸ¬
---

---

## 9. í…œí”Œë¦¿ ì‹œìŠ¤í…œ ì„¤ê³„

### í…œí”Œë¦¿ í‚¤ (Key) ê·œì¹™

| í‚¤ | íƒ€ì… | ì„¤ëª… |
|----|------|------|
| `email_verification` | EMAIL | ì´ë©”ì¼ ì¸ì¦ |
| `password_reset` | EMAIL | ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • |
| `user_withdrawal` | EMAIL | íšŒì› íƒˆí‡´ ì•ˆë‚´ |
| `reservation_confirmed` | EMAIL/SMS/PUSH | ì˜ˆì•½ í™•ì¸ |
| `reservation_cancelled` | EMAIL/SMS/PUSH | ì˜ˆì•½ ì·¨ì†Œ |
| `payment_receipt` | EMAIL | ê²°ì œ ì˜ìˆ˜ì¦ |
| `inquiry_answered` | EMAIL/PUSH | ë¬¸ì˜ ë‹µë³€ ë“±ë¡ |

### í…œí”Œë¦¿ ë Œë”ë§ ì—”ì§„

**Handlebars ì‚¬ìš©:**
```handlebars
<h1>ì•ˆë…•í•˜ì„¸ìš”, {{userName}}ë‹˜!</h1>
<p>ì¸ì¦ ì½”ë“œëŠ” <strong>{{verificationCode}}</strong>ì…ë‹ˆë‹¤.</p>
<p>ë§Œë£Œ ì‹œê°„: {{expiresAt}}</p>
```

**ë³€ìˆ˜ ì¹˜í™˜ ì˜ˆì‹œ:**
```typescript
const template = "ì•ˆë…•í•˜ì„¸ìš”, {{userName}}ë‹˜!";
const variables = { userName: "í™ê¸¸ë™" };
const result = Handlebars.compile(template)(variables);
// "ì•ˆë…•í•˜ì„¸ìš”, í™ê¸¸ë™ë‹˜!"
```

### í…œí”Œë¦¿ ë²„ì „ ê´€ë¦¬

- í…œí”Œë¦¿ ìˆ˜ì • ì‹œ ì´ì „ ë²„ì „ ë³´ê´€ (TemplateHistory í…Œì´ë¸”)
- ë¡¤ë°± ê¸°ëŠ¥ ì œê³µ (í–¥í›„ ê³ ë ¤)

---

## 10. ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

| í•­ëª© | ëŒ€ì‘ ë°©ì•ˆ |
|------|----------|
| HTML Injection | HTML í…œí”Œë¦¿ ì €ì¥ ì‹œ XSS ë°©ì§€ sanitize |
| ë³€ìˆ˜ ê²€ì¦ | í—ˆìš©ëœ ë³€ìˆ˜ë§Œ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ ê²€ì¦ |
| í…ŒìŠ¤íŠ¸ ë°œì†¡ ì œí•œ | ì¼ì¼ í…ŒìŠ¤íŠ¸ ë°œì†¡ íšŸìˆ˜ ì œí•œ (ì˜ˆ: 10íšŒ) |
| ê¶Œí•œ í™•ì¸ | `menu:templates:*` Subject ê¶Œí•œ ì²´í¬ |

---

## 11. ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­

| í•­ëª© | ëŒ€ì‘ ë°©ì•ˆ |
|------|----------|
| í…œí”Œë¦¿ ëª©ë¡ ì¡°íšŒ | í˜ì´ì§€ë„¤ì´ì…˜ ì ìš© (ê¸°ë³¸ 20ê°œ) |
| ë¯¸ë¦¬ë³´ê¸° ë Œë”ë§ | ì„œë²„ ì‚¬ì´ë“œ ë Œë”ë§, ìºì‹± |
| HTML ì—ë””í„° | ì½”ë“œ ì—ë””í„° lazy loading |

---

---

## ğŸ”§ ê¸°ìˆ  ì„¤ê³„

### 1. Entity ìƒì„¸ ì„¤ê³„

#### 1.1 ìƒˆë¡œìš´ Entity

##### Template

**íŒŒì¼ ê²½ë¡œ:** `packages/prisma/prisma/schema/template.prisma`

**í•„ë“œ ìƒì„¸:**

| í•„ë“œ | íƒ€ì… | ì„¤ëª… | ì œì•½ì¡°ê±´ |
|------|------|------|----------|
| id | String | PK, UUID | @id @default(uuid()) |
| seq | Int | ì‹œí€€ìŠ¤ | @unique @default(autoincrement()) |
| name | String | í…œí”Œë¦¿ ì´ë¦„ | @db.VarChar(100) |
| type | TemplateType | í…œí”Œë¦¿ íƒ€ì… | Enum |
| key | String | ì‹œìŠ¤í…œ í‚¤ | @db.VarChar(100) |
| subject | String? | ì œëª© (ì´ë©”ì¼/í‘¸ì‹œ) | @db.VarChar(200) |
| content | String | í…œí”Œë¦¿ ë‚´ìš© | @db.Text |
| variables | String[] | ì‚¬ìš© ê°€ëŠ¥í•œ ë³€ìˆ˜ ëª©ë¡ | @db.VarChar(50)[] |
| isActive | Boolean | í™œì„±í™” ì—¬ë¶€ | @default(true) |
| spaceId | String | Space FK | |
| createdAt | DateTime | ìƒì„±ì¼ | @default(now()) |
| updatedAt | DateTime | ìˆ˜ì •ì¼ | @updatedAt |
| deletedAt | DateTime? | ì‚­ì œì¼ (soft delete) | |

**Prisma ìŠ¤í‚¤ë§ˆ:**

```prisma
enum TemplateType {
  EMAIL
  SMS
  PUSH
  HTML
}

model Template {
  id        String       @id @default(uuid())
  seq       Int          @unique @default(autoincrement())
  name      String       @db.VarChar(100)
  type      TemplateType
  key       String       @db.VarChar(100)
  subject   String?      @db.VarChar(200)
  content   String       @db.Text
  variables String[]     @db.VarChar(50)
  isActive  Boolean      @default(true)
  spaceId   String
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  deletedAt DateTime?

  space Space @relation(fields: [spaceId], references: [id])

  @@unique([key, spaceId])
  @@index([type])
  @@index([spaceId])
  @@index([isActive])
  @@map("templates")
}
```

**ì¸ë±ìŠ¤ ì„¤ê³„:**

| ì¸ë±ìŠ¤ëª… | í•„ë“œ | ìš©ë„ |
|----------|------|------|
| @@unique | key, spaceId | ë™ì¼ Space ë‚´ key ì¤‘ë³µ ë°©ì§€ |
| idx_template_type | type | íƒ€ì…ë³„ ì¡°íšŒ ì„±ëŠ¥ ìµœì í™” |
| idx_template_spaceId | spaceId | Spaceë³„ ì¡°íšŒ ì„±ëŠ¥ ìµœì í™” |
| idx_template_isActive | isActive | í™œì„± í…œí”Œë¦¿ ì¡°íšŒ ìµœì í™” |

**ê´€ê³„:**

```
Space 1 â”€â”€â”€â”€ N Template
         â””â”€â”€â”€â”€ FK: spaceId
```

##### TemplateHistory (ì„ íƒì , í–¥í›„ êµ¬í˜„)

ë²„ì „ ê´€ë¦¬ë¥¼ ìœ„í•œ ì´ë ¥ í…Œì´ë¸”

```prisma
model TemplateHistory {
  id         String       @id @default(uuid())
  templateId String
  version    Int
  name       String       @db.VarChar(100)
  subject    String?      @db.VarChar(200)
  content    String       @db.Text
  variables  String[]     @db.VarChar(50)
  changedBy  String       // ìˆ˜ì •í•œ ê´€ë¦¬ì ID
  createdAt  DateTime     @default(now())

  template Template @relation(fields: [templateId], references: [id])

  @@index([templateId])
  @@map("template_histories")
}
```

#### 1.2 ê¸°ì¡´ Entity ìˆ˜ì •

**Space ìˆ˜ì •ì‚¬í•­:**

```prisma
model Space {
  // ê¸°ì¡´ í•„ë“œ...

  // ì¶”ê°€í•  ê´€ê³„
  templates Template[]  // ì¶”ê°€
}
```

---

### 2. Repository ë ˆì´ì–´ ì„¤ê³„

**íŒŒì¼:** `packages/repository/src/template.repository.ts`

**ë©”ì„œë“œ ëª…ì„¸:**

| ë©”ì„œë“œëª… | íŒŒë¼ë¯¸í„° | ë°˜í™˜íƒ€ì… | ì„¤ëª… |
|----------|----------|----------|------|
| findManyByTypeAndSpace | type: TemplateType, spaceId: string, pagination: { skip, take } | { items: Template[]; count: number } | íƒ€ì… ë° Spaceë³„ ëª©ë¡ ì¡°íšŒ |
| findByKeyAndSpace | key: string, spaceId: string | Template \| null | keyì™€ spaceIdë¡œ ì¡°íšŒ (ì‹¤ì œ ì‚¬ìš© ì‹œ) |
| findById | id: string | Template \| null | IDë¡œ ì¡°íšŒ |
| findActiveById | id: string | Template \| null | í™œì„±í™”ëœ í…œí”Œë¦¿ ì¡°íšŒ |
| create | data: Prisma.TemplateCreateInput | Template | ìƒì„± |
| updateById | id: string, data: Prisma.TemplateUpdateInput | Template | ìˆ˜ì • |
| softRemoveById | id: string | Template | ì†Œí”„íŠ¸ ì‚­ì œ (deletedAt ì„¤ì •) |
| countByTypeAndSpace | type: TemplateType, spaceId: string | number | ê°œìˆ˜ ì¡°íšŒ |

**êµ¬í˜„ ì˜ˆì‹œ:**

```typescript
async findManyByTypeAndSpace(
  type: TemplateType,
  spaceId: string,
  pagination: { skip: number; take: number }
): Promise<{ items: Template[]; count: number }> {
  const where = {
    type,
    spaceId,
    deletedAt: null,
  };

  const [items, count] = await this.prisma.$transaction([
    this.prisma.template.findMany({
      where,
      skip: pagination.skip,
      take: pagination.take,
      orderBy: { createdAt: 'desc' },
    }),
    this.prisma.template.count({ where }),
  ]);

  return { items, count };
}

async findByKeyAndSpace(
  key: string,
  spaceId: string
): Promise<Template | null> {
  return this.prisma.template.findUnique({
    where: {
      key_spaceId: {
        key,
        spaceId,
      },
      deletedAt: null,
    },
  });
}
```

---

### 3. Service ë ˆì´ì–´ ì„¤ê³„

**íŒŒì¼:** `packages/service/src/service/template.service.ts`

**ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§:**

| ë©”ì„œë“œëª… | ì±…ì„ | í˜¸ì¶œí•˜ëŠ” Repository ë©”ì„œë“œ |
|----------|------|---------------------------|
| getTemplatesByType | íƒ€ì…ë³„ í…œí”Œë¦¿ ëª©ë¡ ì¡°íšŒ | findManyByTypeAndSpace, countByTypeAndSpace |
| getTemplateById | í…œí”Œë¦¿ ìƒì„¸ ì¡°íšŒ | findById |
| getTemplateByKey | keyë¡œ í…œí”Œë¦¿ ì¡°íšŒ (ì‹¤ì œ ì‚¬ìš© ì‹œ) | findByKeyAndSpace |
| createTemplate | í…œí”Œë¦¿ ìƒì„± (ì¤‘ë³µ key ê²€ì¦) | findByKeyAndSpace, create |
| updateTemplate | í…œí”Œë¦¿ ìˆ˜ì • (History ì €ì¥, ì„ íƒì ) | findById, updateById |
| deleteTemplate | í…œí”Œë¦¿ ì‚­ì œ | softRemoveById |
| renderTemplate | Handlebarsë¡œ í…œí”Œë¦¿ ë Œë”ë§ | findById |
| sendTestTemplate | í…ŒìŠ¤íŠ¸ ë°œì†¡ (ì´ë©”ì¼/SMS/í‘¸ì‹œ) | findById, renderTemplate |

**êµ¬í˜„ ì˜ˆì‹œ:**

```typescript
async renderTemplate(
  templateId: string,
  variables: Record<string, any>
): Promise<string> {
  const template = await this.templateRepository.findActiveById(templateId);
  if (!template) {
    throw new NotFoundException('í…œí”Œë¦¿ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
  }

  // Handlebars ì»´íŒŒì¼
  const compiled = Handlebars.compile(template.content);
  return compiled(variables);
}

async sendTestTemplate(
  templateId: string,
  recipient: string,
  variables: Record<string, any>
): Promise<void> {
  const template = await this.templateRepository.findActiveById(templateId);
  if (!template) {
    throw new NotFoundException('í…œí”Œë¦¿ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
  }

  const renderedContent = await this.renderTemplate(templateId, variables);

  switch (template.type) {
    case TemplateType.EMAIL:
      await this.emailService.send({
        to: recipient,
        subject: template.subject || '',
        html: renderedContent,
      });
      break;
    case TemplateType.SMS:
      await this.smsService.send({
        to: recipient,
        content: renderedContent,
      });
      break;
    case TemplateType.PUSH:
      await this.pushService.send({
        to: recipient,
        title: template.subject || '',
        body: renderedContent,
      });
      break;
    default:
      throw new BadRequestException('ì§€ì›í•˜ì§€ ì•ŠëŠ” í…œí”Œë¦¿ íƒ€ì…ì…ë‹ˆë‹¤');
  }
}
```

---

### 4. Controller ë ˆì´ì–´ ì„¤ê³„

**íŒŒì¼:** `apps/server/src/module/template/template.controller.ts`

**ì—”ë“œí¬ì¸íŠ¸ ìƒì„¸:**

#### GET /api/v1/admin/templates

| í•­ëª© | ë‚´ìš© |
|------|------|
| ì„¤ëª… | í…œí”Œë¦¿ ëª©ë¡ ì¡°íšŒ |
| ì¸ì¦ | Bearer Token |
| ê¶Œí•œ | CASL Subject: `menu:templates` |

**Query Parameters:**
| íŒŒë¼ë¯¸í„° | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… |
|----------|------|------|------|
| type | TemplateType | N | í…œí”Œë¦¿ íƒ€ì… í•„í„° (EMAIL, SMS, PUSH, HTML) |
| page | number | N | í˜ì´ì§€ ë²ˆí˜¸ (default: 1) |
| limit | number | N | í˜ì´ì§€ë‹¹ ê°œìˆ˜ (default: 20) |

**Response (200):**
```json
{
  "data": [
    {
      "id": "uuid",
      "name": "ì´ë©”ì¼ ì¸ì¦",
      "type": "EMAIL",
      "key": "email_verification",
      "subject": "ì´ë©”ì¼ ì¸ì¦ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”",
      "content": "<!DOCTYPE html>...",
      "variables": ["userName", "verificationCode"],
      "isActive": true,
      "createdAt": "2025-01-01T00:00:00Z",
      "updatedAt": "2025-01-01T00:00:00Z"
    }
  ],
  "meta": {
    "total": 20,
    "page": 1,
    "limit": 20
  }
}
```

#### POST /api/v1/admin/templates

| í•­ëª© | ë‚´ìš© |
|------|------|
| ì„¤ëª… | í…œí”Œë¦¿ ìƒì„± |
| ì¸ì¦ | Bearer Token |
| ê¶Œí•œ | CASL Subject: `menu:templates` |

**Request Body:**
```json
{
  "name": "ì´ë©”ì¼ ì¸ì¦",
  "type": "EMAIL",
  "key": "email_verification",
  "subject": "ì´ë©”ì¼ ì¸ì¦ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”",
  "content": "<!DOCTYPE html>...",
  "variables": ["userName", "verificationCode", "expiresAt"]
}
```

**Error Responses:**
| ì½”ë“œ | ì„¤ëª… |
|------|------|
| 400 | ìœ íš¨ì„± ê²€ì¦ ì‹¤íŒ¨ |
| 401 | ì¸ì¦ ì‹¤íŒ¨ |
| 403 | ê¶Œí•œ ì—†ìŒ |
| 409 | ì¤‘ë³µëœ key |

#### POST /api/v1/admin/templates/:id/preview

| í•­ëª© | ë‚´ìš© |
|------|------|
| ì„¤ëª… | í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸° ë Œë”ë§ |
| ì¸ì¦ | Bearer Token |

**Request Body:**
```json
{
  "variables": {
    "userName": "í™ê¸¸ë™",
    "verificationCode": "123456",
    "expiresAt": "2025-01-01 12:00:00"
  }
}
```

**Response (200):**
```json
{
  "html": "<!DOCTYPE html><html>...</html>"
}
```

#### POST /api/v1/admin/templates/:id/test

| í•­ëª© | ë‚´ìš© |
|------|------|
| ì„¤ëª… | í…ŒìŠ¤íŠ¸ ë°œì†¡ |
| ì¸ì¦ | Bearer Token |

**Request Body:**
```json
{
  "recipient": "test@example.com",
  "variables": {
    "userName": "í™ê¸¸ë™",
    "verificationCode": "123456"
  }
}
```

**Response (200):**
```json
{
  "message": "í…ŒìŠ¤íŠ¸ ë°œì†¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤"
}
```

---

### 5. DTO ì„¤ê³„

**íŒŒì¼:** `packages/dto/src/template/`

| DTO í´ë˜ìŠ¤ | ìš©ë„ | í•„ë“œ |
|------------|------|------|
| CreateTemplateDto | ìƒì„± ìš”ì²­ | name, type, key, subject?, content, variables[] |
| UpdateTemplateDto | ìˆ˜ì • ìš”ì²­ | name?, subject?, content?, isActive? |
| TemplateResponseDto | ì‘ë‹µ | id, name, type, key, subject, content, variables, isActive, createdAt, updatedAt |
| PreviewTemplateDto | ë¯¸ë¦¬ë³´ê¸° ìš”ì²­ | variables: Record<string, any> |
| TestSendTemplateDto | í…ŒìŠ¤íŠ¸ ë°œì†¡ ìš”ì²­ | recipient, variables: Record<string, any> |
| GetTemplatesQueryDto | ëª©ë¡ ì¡°íšŒ ì¿¼ë¦¬ | type?, page?, limit? |

**êµ¬í˜„ ì˜ˆì‹œ:**

```typescript
// CreateTemplateDto
import { IsString, IsEnum, IsOptional, IsArray, MaxLength } from 'class-validator';

export class CreateTemplateDto {
  @IsString()
  @MaxLength(100)
  name: string;

  @IsEnum(TemplateType)
  type: TemplateType;

  @IsString()
  @MaxLength(100)
  key: string;

  @IsString()
  @IsOptional()
  @MaxLength(200)
  subject?: string;

  @IsString()
  content: string;

  @IsArray()
  @IsString({ each: true })
  variables: string[];
}

// TestSendTemplateDto
export class TestSendTemplateDto {
  @IsString()
  recipient: string;

  @IsObject()
  variables: Record<string, any>;
}
```

---

### 6. ê¸°ìˆ  ê³ ë ¤ì‚¬í•­

#### 6.1 ë³´ì•ˆ

| í•­ëª© | ëŒ€ì‘ ë°©ì•ˆ |
|------|----------|
| HTML Injection | DOMPurifyë¡œ HTML sanitize (ì €ì¥ ì „) |
| XSS | í…œí”Œë¦¿ ë³€ìˆ˜ escape ì²˜ë¦¬ |
| ë³€ìˆ˜ ê²€ì¦ | variables ë°°ì—´ì— ì •ì˜ëœ ë³€ìˆ˜ë§Œ í—ˆìš© |
| ê¶Œí•œ í™•ì¸ | CASL abilityë¡œ `menu:templates` ì²´í¬ |
| í…ŒìŠ¤íŠ¸ ë°œì†¡ ì œí•œ | Rate limiting (1ë¶„ë‹¹ 10íšŒ) |
| SQL Injection | Prisma ORM ì‚¬ìš© (íŒŒë¼ë¯¸í„°í™” ì¿¼ë¦¬) |

#### 6.2 ì„±ëŠ¥

| í•­ëª© | ëŒ€ì‘ ë°©ì•ˆ |
|------|----------|
| í…œí”Œë¦¿ ì¡°íšŒ | Redis ìºì‹± (key: `template:{spaceId}:{key}`, TTL: 1ì‹œê°„) |
| ë Œë”ë§ ìµœì í™” | Handlebars ì»´íŒŒì¼ ê²°ê³¼ ìºì‹± |
| ëª©ë¡ ì¡°íšŒ | í˜ì´ì§€ë„¤ì´ì…˜ (ê¸°ë³¸ 20ê°œ) |
| ì¸ë±ìŠ¤ í™œìš© | type, spaceId, key ì¸ë±ìŠ¤ í™œìš© |

#### 6.3 ì—ëŸ¬ ì²˜ë¦¬

| ì—ëŸ¬ ìƒí™© | HTTP ì½”ë“œ | ì—ëŸ¬ ë©”ì‹œì§€ |
|----------|-----------|-------------|
| í…œí”Œë¦¿ ì—†ìŒ | 404 | "í…œí”Œë¦¿ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" |
| ì¤‘ë³µ key | 409 | "ì´ë¯¸ ì¡´ì¬í•˜ëŠ” í…œí”Œë¦¿ í‚¤ì…ë‹ˆë‹¤" |
| ë³€ìˆ˜ ê²€ì¦ ì‹¤íŒ¨ | 400 | "ìœ íš¨í•˜ì§€ ì•Šì€ ë³€ìˆ˜ì…ë‹ˆë‹¤: {variable}" |
| ë Œë”ë§ ì‹¤íŒ¨ | 500 | "í…œí”Œë¦¿ ë Œë”ë§ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤" |
| ë°œì†¡ ì‹¤íŒ¨ | 500 | "í…ŒìŠ¤íŠ¸ ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤" |

#### 6.4 í…œí”Œë¦¿ ë Œë”ë§

**Handlebars ì‚¬ìš©:**

```typescript
import Handlebars from 'handlebars';

// Helper ë“±ë¡
Handlebars.registerHelper('formatDate', (date: string) => {
  return new Date(date).toLocaleDateString('ko-KR');
});

// ë Œë”ë§
const template = Handlebars.compile(templateContent);
const result = template(variables);
```

#### 6.5 í…ŒìŠ¤íŠ¸ ë°œì†¡

**ì´ë©”ì¼ ë°œì†¡ (NodeMailer):**
```typescript
await this.mailer.sendMail({
  from: 'noreply@example.com',
  to: recipient,
  subject: subject,
  html: renderedContent,
});
```

**SMS ë°œì†¡ (ì•Œë¦¬ê³  API):**
```typescript
await this.smsService.send({
  receiver: recipient,
  msg: renderedContent,
});
```

**í‘¸ì‹œ ë°œì†¡ (FCM):**
```typescript
await this.fcm.send({
  token: userDeviceToken,
  notification: {
    title: subject,
    body: renderedContent,
  },
});
```

---

### 7. ë§ˆì´ê·¸ë ˆì´ì…˜ ê³„íš

**ìˆœì„œ:**

1. `packages/prisma/prisma/schema/template.prisma` íŒŒì¼ ìƒì„±
2. TemplateType Enum ì¶”ê°€
3. Space ëª¨ë¸ì— templates ê´€ê³„ ì¶”ê°€
4. `pnpm prisma:migrate dev --name add-template-system` ì‹¤í–‰
5. Entity í´ë˜ìŠ¤ ìƒì„± (`packages/entity/src/template.entity.ts`)
6. ê¸°ë³¸ í…œí”Œë¦¿ ì‹œë“œ ë°ì´í„° ì¶”ê°€

**ì‹œë“œ ë°ì´í„° ì˜ˆì‹œ:**

```typescript
// prisma/seed/template.seed.ts
const defaultTemplates = [
  {
    name: 'ì´ë©”ì¼ ì¸ì¦',
    type: 'EMAIL',
    key: 'email_verification',
    subject: 'ì´ë©”ì¼ ì¸ì¦ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”',
    content: `
      <h1>ì•ˆë…•í•˜ì„¸ìš”, {{userName}}ë‹˜!</h1>
      <p>ì¸ì¦ ì½”ë“œëŠ” <strong>{{verificationCode}}</strong>ì…ë‹ˆë‹¤.</p>
      <p>ë§Œë£Œ ì‹œê°„: {{expiresAt}}</p>
    `,
    variables: ['userName', 'verificationCode', 'expiresAt'],
  },
  {
    name: 'ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •',
    type: 'EMAIL',
    key: 'password_reset',
    subject: 'ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ì•ˆë‚´',
    content: `
      <h1>ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •</h1>
      <p>{{userName}}ë‹˜, ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë§í¬ì…ë‹ˆë‹¤.</p>
      <a href="{{resetLink}}">ì¬ì„¤ì •í•˜ê¸°</a>
    `,
    variables: ['userName', 'resetLink'],
  },
  {
    name: 'íšŒì› íƒˆí‡´ ì•ˆë‚´',
    type: 'EMAIL',
    key: 'user_withdrawal',
    subject: 'íšŒì› íƒˆí‡´ ì™„ë£Œ',
    content: `
      <h1>{{userName}}ë‹˜, ê·¸ë™ì•ˆ ê°ì‚¬í–ˆìŠµë‹ˆë‹¤</h1>
      <p>íƒˆí‡´ ì²˜ë¦¬ì¼: {{withdrawalDate}}</p>
      <p>ë°ì´í„° ë³´ê´€ ê¸°ê°„: {{dataRetentionPeriod}}</p>
    `,
    variables: ['userName', 'withdrawalDate', 'dataRetentionPeriod'],
  },
];
```

**ë¡¤ë°± ê³„íš:**
- ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨ ì‹œ `prisma migrate reset` ê³ ë ¤
- ìš´ì˜ í™˜ê²½ì—ì„œëŠ” down migration ìŠ¤í¬ë¦½íŠ¸ ì¤€ë¹„

---

## 12. ê´€ë ¨ ë¬¸ì„œ

- [AdminLayoutAndMenuSystem](./2025-12-30-AdminLayoutAndMenuSystem.md) - ì–´ë“œë¯¼ ë ˆì´ì•„ì›ƒ ë° ë©”ë‰´
- [SignupSystem](./2025-12-30-SignupSystem.md) - íšŒì›ê°€ì… ì‹œìŠ¤í…œ (ì´ë©”ì¼ ì¸ì¦ ì‚¬ìš©)
